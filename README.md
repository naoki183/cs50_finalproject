# 競馬予想.com
#### Video Demo:  https://youtu.be/6sFvp5x5iBk
#### Description:

　まずはnetkeiba.comからデータのスクレイピングを行いました(>"scraping.py")．集めたデータは>"data.csv"に1行ずつ入れていきました．データの詳細は以下の通りです．
集めたデータは中央競馬のみです．使いたいデータが1つでも欠けていた場合は書き込まないようにしました．

* 正解ラベル(馬1が勝ちなら0,馬2が勝ちなら１)
* レースの距離(/3000)
* レースのfield(ダート1, 芝2)(/2)
* 4. レースの天気(晴1，曇2，雨3，小雨4，雪5，小雪6)(/6)
* 5. レースのコンディション(良1，稍2，重3，不4)(/4)
* 6. レースの場所(札幌1，函館2，福島3，中山4，東京5，新潟6，中京7，京都8，阪神9，小倉10)(/10)
* 7. 馬1の1位になった割合
* 8. 馬1の2位になった割合
* 9. 馬1の3位になった割合
* 10. 馬1の4位以降になった割合
* 11. 馬1のこれまでの試合数(/100)
* 12. 馬1のコンディション適性(プロフィールサイトの棒グラフの左の割合)
* 13. 馬1の距離適正
* 14. 馬1のフィールド適正
* 15. 馬1の成長特性
* 16. 馬1の脚質
* 17. 馬1の前回レースの10mあたりのタイム(秒)(×1.6)
* 18. 馬1の前回レースの天気(晴1，曇2，雨3，小雨4，雪5，小雪6)(/6)
* 19. 馬1の前回レースのfield(ダート1, 芝2)(/2)
* 20. 馬1の前回レースの距離(/3000)
* 21. 馬1の前回レースのコンディション(良1，稍2，重3，不4)(/4)
* 22. 馬1の前回レースの上がり3ハロンのタイム(秒)(/40)
* 23. 馬1の前回レースの場所(札幌1，函館2，福島3，中山4，東京5，新潟6，中京7，京都8，阪神9，小倉10)(/10)
* 24. 馬1の前回レースの体重変化(/20)(◎前々前回分は取得していない)
* 25. 馬1の前回レースのレース間隔(年)(◎前々前回分は取得していない)
* 26. 馬1の前回レースの年齢(/6)
* 27. 馬1の前回レースのジョッキーの前年度順位(/130)
* 28. 馬1の前々回レースの10mあたりのタイム(秒)(×1.6)
* 29. 馬1の前々回レースの天気(晴1，曇2，雨3，小雨4，雪5，小雪6)(/6)
* 30. 馬1の前々回レースのfield(ダート1, 芝2)(/2)
* 31. 馬1の前々回レースの距離(/3000)
* 32. 馬1の前々回レースのコンディション(良1，稍2，重3，不4)(/4)
* 33. 馬1の前々回レースの上がり3ハロンのタイム(秒)(/40)
* 34. 馬1の前々回レースの場所(札幌1，函館2，福島3，中山4，東京5，新潟6，中京7，京都8，阪神9，小倉10)(/10)
* 35. 馬1の前々回レースの体重変化(/20)(◎前々前回分は取得していない)
* 36. 馬1の前々回レースのレース間隔(年)(◎前々前回分は取得していない)
* 37. 馬1の前々回レースの年齢(/6)
* 38. 馬1の前々回レースのジョッキーの前年度順位(/130)
* 39. 馬1の前々前回レースの10mあたりのタイム(秒)(×1.6)
* 40. 馬1の前々前回レースの天気(晴1，曇2，雨3，小雨4，雪5，小雪6)(/6)
* 41. 馬1の前々前回レースのfield(ダート1, 芝2)(/2)
* 42. 馬1の前々前回レースの距離(/3000)
* 43. 馬1の前々前回レースのコンディション(良1，稍2，重3，不4)(/4)
* 44. 馬1の前々前回レースの上がり3ハロンのタイム(秒)(/40)
* 45. 馬1の前々前回レースの場所(札幌1，函館2，福島3，中山4，東京5，新潟6，中京7，京都8，阪神9，小倉10)(/10)
* 46. 馬1の前々前回レースの年齢(/6)
* 47. 馬1の前々前回レースのジョッキーの前年度成績(/130)
* 48. 馬1の年齢(/6)
* 49. 馬1のレース間隔(年)
* 50. 馬1の体重変化(/20)
* 51. 馬1のジョッキーの前年度順位(/130)
* 52. 馬1の性別(牡馬1，牝馬2，セ3)
* 53. 馬2の1位になった割合
* 54. 馬2の2位になった割合
* 55. 馬2の3位になった割合
* 56. 馬2の4位以降になった割合
* 57. 馬2のこれまでの試合数(/100)
* 58. 馬2のコンディション適性(プロフィールサイトの棒グラフの左の割合)
* 59. 馬2の距離適正
* 60. 馬2のフィールド適正
* 61. 馬2の成長特性
* 62. 馬2の脚質
* 63. 馬2の前回レースの10mあたりのタイム(秒)(×1.6)
* 64. 馬2の前回レースの天気(晴1，曇2，雨3，小雨4，雪5，小雪6)(/6)
* 65. 馬2の前回レースのfield(ダート1, 芝2)(/2)
* 66. 馬2の前回レースの距離(/3000)
* 67. 馬2の前回レースのコンディション(良1，稍2，重3，不4)(/4)
* 68. 馬2の前回レースの上がり3ハロンのタイム(秒)(/40)
* 69. 馬2の前回レースの場所(札幌1，函館2，福島3，中山4，東京5，新潟6，中京7，京都8，阪神9，小倉10)(/10)
* 70. 馬2の前回レースの体重変化(/20)(◎前々前回分は取得していない)
* 71. 馬2の前回レースのレース間隔(年)(◎前々前回分は取得していない)
* 72. 馬2の前回レースの年齢(/6)
* 73. 馬2の前回レースのジョッキーの前年度順位(/130)
* 74. 馬2の前々回レースの10mあたりのタイム(秒)(×1.6)
* 75. 馬2の前々回レースの天気(晴1，曇2，雨3，小雨4，雪5，小雪6)(/6)
* 76. 馬2の前々回レースのfield(ダート1, 芝2)(/2)
* 77. 馬2の前々回レースの距離(/3000)
* 78. 馬2の前々回レースのコンディション(良1，稍2，重3，不4)(/4)
* 79. 馬2の前々回レースの上がり3ハロンのタイム(秒)(/40)
* 80. 馬2の前々回レースの場所(札幌1，函館2，福島3，中山4，東京5，新潟6，中京7，京都8，阪神9，小倉10)(/10)
* 81. 馬2の前々回レースの体重変化(/20)(◎前々前回分は取得していない)
* 82. 馬2の前々回レースのレース間隔(年)(◎前々前回分は取得していない)
* 83. 馬2の前々回レースの年齢(/6)
* 84. 馬2の前々回レースのジョッキーの前年度順位(/130)
* 85. 馬2の前々前回レースの10mあたりのタイム(秒)(×1.6)
* 86. 馬2の前々前回レースの天気(晴1，曇2，雨3，小雨4，雪5，小雪6)(/6)
* 87. 馬2の前々前回レースのfield(ダート1, 芝2)(/2)
* 88. 馬2の前々前回レースの距離(/3000)
* 89. 馬2の前々前回レースのコンディション(良1，稍2，重3，不4)(/4)
* 90. 馬2の前々前回レースの上がり3ハロンのタイム(秒)(/40)
* 91. 馬2の前々前回レースの場所(札幌1，函館2，福島3，中山4，東京5，新潟6，中京7，京都8，阪神9，小倉10)(/10)
* 92. 馬2の前々前回レースの年齢(/6)
* 93. 馬2の前々前回レースのジョッキーの前年度成績(/130)
* 94. 馬2の年齢(/6)
* 95. 馬2のレース間隔(年)
* 96. 馬2の体重変化(/20)
* 97. 馬2のジョッキーの前年度順位(/130)
* 98. 馬2の性別(牡馬1，牝馬2，セ3)

　次に，データをレース会場ごとに分割しました(>data_place.py)．それぞれのデータは>"会場名.csv"(会場名はSapporoなど)に保存しました．
　次に，用いた学習アルゴリズムについてです．タスクとして，2頭の馬のデータ，レース当日の環境データから，どちらの馬が勝つかを予測する
2値分類のタスクを行いました．学習アルゴリズムは以下の3つを使って，最も精度の良かったLightGBMを採用しました．モデルは各会場ごとに>"会場名_pred.txt"に保存しました．
データローダーにはtorch.utilsを用いました．
* > deeplearning.py: deep learning(予測値としてスカラーを用い，0.5以下なら0，0.5より大きければ1と予測) 予測精度70% (主な使用ライブラリ:pytorch)
* > lgbm.py: LightGBM(決定木)　予測精度85% (主な使用ライブラリ:lgbm)
* > learning3.py: ロジスティック回帰 予測精度65% (主な使用ライブラリ:sklearn.linear_model)

　次に，データの正則化のための式を>"save_transform.py"を用いて，>"会場名_scaler.pickle"に保存しました．
　サイトの実装についてです．実装はFlaskを使って行いました．index.htmlにはユーザのURLの入力を受け付けるウィンドウがあります．URLを入力して"予測"
ボタンを押すとpython側で先ほど保存したモデルを使った計算が始まります．無効なURLを入力した場合はエラーがalertで出ます．計算が終わるとpredict.htmlに切り替わり，
どの馬が他の馬に何勝するかの予測結果が出ます．データが足りない馬については予測の対象外とし，一番上にリスト化されます．データのある馬については
selectウィンドウから2頭の馬を選択して勝つ方の馬を出力できます．